# dashboard

This folder contains the code used in [the school mergers paper](https://academic.oup.com/pnasnexus/article/4/3/pgaf050/8046446) for data analysis and at our [School Mergers Dashboard](https://mergers.schooldiversity.org/).

Contact Madison Landry (`landry.ma` at northeastern dot edu) for help.

## Setup

Create a virtual environment with your favorite Python version (we use 3.10), and install the required packages.

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

To run the dashboard locally, run `main.py` with Streamlit.

```bash
streamlit run main.py
```

The interface runs at <http://localhost:8501> and may take half a minute to first start up.

See below for the functionality of respective files.

## Code organization

### Root

* `eat.py` — Code responsible for interpretting ("digesting") the low-level CSVs into high level object-oriented data classes used by other files. Documentation is rendered here: [`eat.py` documentation](https://web.mit.edu/almonds/www/mergers/).
* `headers.py` — Includes definitions that most other code files share.
* `logger.py` — Save analytics to `./logs`.
* `main.py` — Streamlit dashboard.
* `make_figs.py` — Generate figures and CSVs.
* `maps.py` — For the dashboard's map interface.
* `morans_i.py` — For spatial autocorrelation analyses, centroid calculations, and generating districts' respective files under `data/school_attendance_boundaries`.
* `outlines.py` — Computes the outlines of districts, saved to `data/school_attendance_boundaries/outlines`.
* `summarize.py` — Contains much of the logic that goes into summarizing the simulation results as used in the dashboard.

### `./data/`

This directory must contain the results folders from `mergers_core`, enrollment data, and shapes files. Available for download here: [`school_mergers_data.zip`](https://plural-connections.s3.us-east-1.amazonaws.com/school-mergers/school_mergers_data.zip)

The directories under `data/results` starting with "`min_`" were those results generated by [`mergers_core`](../mergers_core/README.md).  ("Min num elem 4 schools" refers to using districts with at least four elementary schools for these analyses.)  Each of these folders contains various analytics files for respective districts as well as a consolidated analytics CSV.

* `min_num_elem_schools_4_constrained/` — Primary results: **Minimum school enrollment of 80%**.
* `min_num_elem_schools_4_bottomless/` — No minimum school enrollment (0%).
* `min_num_elem_schools_4_interdistrict/` — Minimum school enrollment of 80%, allow interdistrict mergers.
* `min_num_elem_schools_4_bottom_sensitivity/` — Minimum school enrollment of 70% or 90%.
* `min_elem_4_interdistrict_bottom_sensitivity/` — Minimum school enrollment of 0%, 70%, 90%, allowing interdistrict mergers.
* `min_num_elem_4_constrained_bh_wa/` — Minimum school enrollment of 80%, for Black/Hispanic—White/Asian sensitivity analysis.

The remaining files in `data` are required for the dashboard and are related to district, census block, and attendance zone shapes:

* `all_schools_with_names.csv` — Demographic x grade counts for schools, along with school/district names
* `entirely_elem_closed_enrollment_districts.csv` — Districts not including elementary schools that permit out-of-boundary attendance (e.g., magnet programs)
* `state_codes.csv` — Abbreviations and FIPS codes of the US states, DC, and PR
* `school_attendance_boundaries/` — School attendance zone geometries for the 2021/2022 school year

### `./figs/`

Module that `make_figs.py` uses to create high-level CSVs and figures, which are printed to `figure_output/`.

* `dissimilarity.py` — Visualizes the changes in dissimilarity scores, pre- & post-mergers.
* `enrollment.py` — Visualizes the changes in school enrollment, pre- & post-mergers.
* `headers.py` — Definitions that the plotting files share.
* `premake.py` — Generates the high-level results for the largest 200 districts reported in the paper. These files must be generated before plots can be made.
* `travel_times.py` — Visualizes the changes in travel times, pre- & post-mergers.
* `wc_bhwa.py` — Visualizes the Black/Hispanic—White/Asian sensitivity analysis.
